var Poust;!function(a){var b=function(){function a(a){this._element=a,this._started=!1,this._stateListener=null}return a.prototype.setStateListener=function(a){this._stateListener=a},a.prototype.init=function(){this._element.setAttribute("class","")},a.prototype.start=function(){this._started=!0},a.prototype.stop=function(){this._started=!1},a.prototype.destroy=function(){this._element.setAttribute("class","hidden")},a.prototype.isStarted=function(){return this._started},a.prototype.fireStateChangeEvent=function(a){this._stateListener&&this._stateListener(this,a)},a}();a.AbstractState=b}(Poust||(Poust={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Poust;!function(a){var b=function(a){function b(b){var c=this;a.call(this,b),this._animationFrameCallback=function(a){if(c.isStarted()){if(null!=c._lastUpdateMillis){var b=a-c._lastUpdateMillis;b>0&&200>b&&(c.update(b),c.render())}c._lastUpdateMillis=a,c.isStarted()&&requestAnimationFrame(c._animationFrameCallback)}else c._lastUpdateMillis=null}}return __extends(b,a),b.prototype.start=function(){a.prototype.start.call(this),requestAnimationFrame(this._animationFrameCallback)},b.prototype.stop=function(){a.prototype.stop.call(this)},b.prototype.update=function(a){},b.prototype.render=function(){},b}(a.AbstractState);a.AbstractUpdatingState=b}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c=function(){function b(a){this._groupId=a,this._dead=!1,this._sensor=!1,this._continuousCollisions=!1,this._collidable=!0,this._stateAgeMillis=0}return b.prototype.setState=function(a,b){(this._state!=a||b)&&(this._state=a,this._stateAgeMillis=0)},b.prototype.getState=function(){return this._state},b.prototype.getStateAgeMillis=function(){return this._stateAgeMillis},b.prototype.getGroupId=function(){return this._groupId},b.prototype.getBounds=function(){return this._bounds},b.prototype.getVelocityRadiusPX=function(){return 0},b.prototype.setVelocityRadiusPX=function(a){},b.prototype.getVelocityAngleRadians=function(a){return 0},b.prototype.setVelocityAngleRadians=function(a,b){},b.prototype.setAnchorRight=function(a){},b.prototype.getMass=function(){return null},b.prototype.calculateMotion=function(b){return new a.Level.Motion.PolarMotion(this.getBounds(),this)},b.prototype.notifyCollision=function(a,b){},b.prototype.update=function(a,b){this._stateAgeMillis+=b,this._bounds.getInnerRadiusPx()<=0&&this.setDead()},b.prototype.isDead=function(){return this._dead},b.prototype.setDead=function(){this._dead=!0},b.prototype.isSensor=function(){return this._sensor},b.prototype.isCollidable=function(){return this._collidable},b.prototype.setSensor=function(a){this._sensor=a},b.prototype.isContinuousCollisions=function(){return this._continuousCollisions},b}();b.AbstractEntity=c}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c=function(c){function d(a,b,d){c.call(this,a),this._mass=b,this._respectsGravity=d,this._velocityAPX=0,this._velocityRPX=0,this._anchorRight=!1}return __extends(d,c),d.prototype.setVelocity=function(a,b){this._velocityRPX=a,this._velocityAPX=b},d.prototype.getVelocityRadiusPX=function(){return this._velocityRPX},d.prototype.setVelocityRadiusPX=function(a){this._velocityRPX=a},d.prototype.getVelocityAngleRadians=function(a){return this._velocityAPX/a},d.prototype.setVelocityAngleRadians=function(a,b){this._velocityAPX=a*b},d.prototype.setAnchorRight=function(a){this._anchorRight!=a&&(this._anchorRight=a)},d.prototype.getMass=function(){return this._mass},d.prototype.calculateMotion=function(a){var c,d=this.getBounds(),e=this._velocityRPX*a,f=this._velocityAPX*a,g=d.getInnerRadiusPx()+e,h=f/g,i=this._widthPx/g;c=this._anchorRight?d.getEndAngleRadians()-i:d.getStartAngleRadians(),c+=h;var j=new b.PolarBounds(g,c,this._heightPx,i);return j.normalize(),this._createMotion(j)},d.prototype.calculateBounds=function(a,c,d,e){var f=this._widthPx/a,g=new b.PolarBounds(a,c,this._heightPx,f);return g.normalize(),g},d.prototype.setBounds=function(a,b,c,d){d&&(this._widthPx=d),c&&(this._heightPx=c);var e=this.calculateBounds(a,b,c,d);this._bounds=e},d.prototype._createMotion=function(b){return new a.Level.Motion.PolarMotion(b,this)},d.prototype.update=function(a,b){c.prototype.update.call(this,a,b),this._respectsGravity&&(this._velocityRPX-=b*(a.getGravity()/(Math.abs(this._velocityAPX)+1)))},d}(b.AbstractEntity);b.AbstractPolarEntity=c}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e){c.call(this,a),this._widthPx=b,this._heightPx=d,this._mass=e,this._velocityDx=0,this._velocityDy=0}return __extends(d,c),d.prototype.setCenter=function(a,b,c){this._cx=a,this._cy=b,null==c&&(c=this.calculateBounds(a,b)),this._bounds=c},d.prototype.isSensor=function(){return!0},d.prototype.calculateBounds=function(a,c){var d=Math.atan2(c,a),e=Math.sqrt(a*a+c*c),f=this._widthPx/e,g=new b.PolarBounds(e-this._heightPx/2,d-f/2,this._heightPx,f);return g.normalize(),g},d.prototype.calculateMotion=function(b){var c=(this.getBounds(),this._cx+b*this._velocityDx),d=this._cy+b*this._velocityDy,e=this.calculateBounds(c,d);return new a.Level.Motion.CartesianMotion(c,d,e,this)},d}(b.AbstractEntity);b.AbstractCartesianEntity=c}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d,e,f){this._millisBetweenShots=a,this._millisBetweenReloads=b,this._clipSize=c,this._recoil=d,this._numGuns=e,this._shootSound=f,this._shootCoolDown=0,this._reloadCoolDown=0,this._ammo=this._clipSize}return c.prototype.update=function(b,c,d,e,f,g,h,i){this._shootCoolDown-=b,d&&(this._reloadCoolDown-=b,this._ammo<this._clipSize&&this._reloadCoolDown<=0&&(this._ammo=this._clipSize,this._reloadCoolDown+=this._millisBetweenReloads));var j=null;if(this._shootCoolDown<=0&&i.length>0&&this._ammo>0){for(var k=(Math.sin(h),Math.cos(h),h*e),l=0,m=a.PolarPoint.rotate(l,k,f),n=0,o=a.PolarPoint.getCartesianPoint(e,f),p=0,q=0;this._ammo>0&&n<i.length;){var r=i[n],s=a.PolarPoint.getCartesianPoint(r.r,r.a),t=this.createBullet(o.x,o.y,s.x,s.y,m.x,m.y);null!=t&&c.addEntity(t);var u=s.x-o.x,v=s.y-o.y,w=Math.sqrt(u*u+v*v);p+=u/w,q+=v/w,n++}p/=n,q/=n;var x=a.PolarPoint.rotate(p*-this._recoil,q*-this._recoil,-f);j=new a.PolarPoint(x.x,x.y),this._shootCoolDown+=this._millisBetweenShots,this._shootSound.play()}return this._reloadCoolDown<0&&(this._reloadCoolDown=0),this._shootCoolDown<0&&(this._shootCoolDown=0),j},c.prototype.createBullet=function(c,d,e,f,g,h){var i=new b.BulletEntity(a.GroupId.Player,10,10,10,1e3);i.setCenter(c,d);var j=e-c,k=f-d,l=Math.sqrt(j*j+k*k),m=.7;return j=j*m/l,k=k*m/l,i._velocityDx=g+j,i._velocityDy=h+k,i},c}();c.AbstractGun=d}(c=b.Gun||(b.Gun={}))}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b){this._bounds=a,this._entity=b}return a.prototype.getBounds=function(){return this._bounds},a.prototype.getEntity=function(){return this._entity},a.prototype.apply=function(a){this._entity._bounds=this._bounds},a}();a.PolarMotion=b}(b=a.Motion||(a.Motion={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b=function(){function a(a){this._paths=a;for(var b in this._paths){var c=this._paths[b],d=new Audio(c);d.preload="yes",d.volume=0,d.play()}}return a.prototype.play=function(){var a=Math.floor(Math.random()*this._paths.length),b=this._paths[a],c=new Audio(b);c.play()},a}();a.AudioSound=b}(Poust||(Poust={}));var Poust;!function(a){var b=function(){function a(a){var b=this;this._stateFactory=a,this._stateListener=function(a,c){a==b._state&&b.setStateFromParam(c)}}return a.prototype.setStateFromParam=function(a){var b=this._stateFactory(a);this.setState(b)},a.prototype.setState=function(a){this._state&&(this._state.setStateListener(null),this._state.stop(),this._state.destroy()),this._state=a,a&&(a.setStateListener(this._stateListener),a.init(),a.start())},a}();a.Engine=b}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h,i){this.sensorCollision=a,this.collisionTime=b,this.nearestCollisionIntersection=c,this.entityHolder1=d,this.bestMotion1=e,this.collisionMotion1=f,this.entityHolder2=g,this.bestMotion2=h,this.collisionMotion2=i}return a}();a.Collision=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function b(b,c,d,e){a.call(this,b,c,d),this._deathSound=e}return __extends(b,a),b.prototype.setDying=function(a){this._dying||(this._dying=!0,this._killedBy=a,this._deathSound.play())},b.prototype.isDying=function(){return this._dying},b.prototype.update=function(b,c){a.prototype.update.call(this,b,c),this.isDying()?this.updateDying(b,c):this.updateAlive(b,c)},b.prototype.updateDying=function(a,b){if(this._collidable&&(this._collidable=!1,this._respectsGravity=!0,this._killedBy)){var c=this.getMass(),d=this._killedBy.getMass();if(null!=c&&null!=d){var e=this.getVelocityRadiusPX(),f=this._killedBy.getVelocityRadiusPX(),g=this._velocityAPX,h=this._killedBy.getVelocityAngleRadians(e),i=h*e,j=(e*c+f*d)/(c+d),k=(g*c+i*d)/(c+d);this._velocityRPX=j,this._velocityAPX=k}else this._velocityAPX=-this._velocityAPX,this._velocityRPX=-this._velocityRPX}this.getBounds().getInnerRadiusPx()<=0&&this.setDead()},b.prototype.updateAlive=function(a,b){},b}(a.AbstractPolarEntity);b.AbstractLivingPolarEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e,f,g){c.call(this,a,b,!1,d),this._velocity=e,this._goingUp=f,this._goingLeft=g}return __extends(d,c),d.prototype.updateAlive=function(a,b){this._goingLeft?this._velocityAPX=-this._velocity:this._velocityAPX=this._velocity,this._goingUp?this._velocityRPX=this._velocity:this._velocityRPX=-this._velocity},d.prototype.notifyCollision=function(c,d){c instanceof b.BulletEntity?this.setDying(c):d==a.PolarEdge.Left?this._goingLeft=!1:d==a.PolarEdge.Right?this._goingLeft=!0:d==a.PolarEdge.Bottom?this._goingUp=!0:d==a.PolarEdge.Top&&(this._goingUp=!1)},d}(b.AbstractLivingPolarEntity);b.BouncyEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function b(b,c,d,e,f){a.call(this,b,c,d,e),this._lifespanMillis=f,this._lifeRemainingMillis=this._lifespanMillis,this._continuousCollisions=!0}return __extends(b,a),b.prototype.update=function(b,c){a.prototype.update.call(this,b,c),this._lifeRemainingMillis-=c,this._lifeRemainingMillis<0&&this.setDead()},b.prototype.notifyCollision=function(a,b){this.setDead()},b}(a.AbstractCartesianEntity);b.BulletEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e,f,g,h){c.call(this,a,b,!0,d),this._goingLeft=e,this._lateralVelocity=f,this._flapVelocity=g,this._minRadius=h}return __extends(d,c),d.prototype.updateAlive=function(a,b){this._goingLeft?this._velocityAPX=-this._lateralVelocity:this._velocityAPX=this._lateralVelocity,(this.getBounds().getInnerRadiusPx()<this._minRadius||this._flapAnyway)&&(this._velocityRPX=this._flapVelocity,this.setState(d.STATE_FLAP,!0)),this._flapAnyway=!1},d.prototype.notifyCollision=function(c,d){c instanceof b.BulletEntity?this.setDying(c):d==a.PolarEdge.Left?this._goingLeft=!1:d==a.PolarEdge.Right?this._goingLeft=!0:d==a.PolarEdge.Bottom&&(this._flapAnyway=!0)},d.STATE_FLAP="flap",d}(b.AbstractLivingPolarEntity);b.FlappyEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(c){b.call(this,a.GroupId.Enemy),this._nextLevelParamsFactory=c,this.setSensor(!0)}return __extends(c,b),c}(a.AbstractEntity);b.LevelExitEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function b(b,c){a.call(this,b,null,!1),this._obstacleType=c,this.setSensor(!0)}return __extends(b,a),b.prototype.getObstacleType=function(){return this._obstacleType},b}(a.AbstractPolarEntity);b.ObstacleEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){!function(a){a[a.Spike=0]="Spike",a[a.Fire=1]="Fire"}(a.ObstacleType||(a.ObstacleType={}));a.ObstacleType}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(a,b,c,e,f,g,h){d.call(this,a,b,!0,f),this._jumpPower=c,this._gun=e,this._jumpNSound=g,this._winSound=h,this._runningLeft=!0,this._targets={},this._continuousCollisions=!0}return __extends(e,d),e.prototype.reset=function(a,b){this.setBounds(a,b),this._velocityAPX=0,this._velocityRPX=0},e.prototype.setTarget=function(a,d,e,f,g){var h=this._targets[a];null==h?(f&&(this._onGround&&g==b.Gesture.Down?h=new c.PlayerEntityTarget(!0,d,e):this._onLeftWall&&g==b.Gesture.Left?h=new c.PlayerEntityTarget(!0,d,e):this._onRightWall&&g==b.Gesture.Right&&(h=new c.PlayerEntityTarget(!0,d,e))),null==h&&(h=new c.PlayerEntityTarget(!1,d,e)),this._targets[a]=h):(h.a=e,h.r=d)},e.prototype.copyTargets=function(){var a={};for(var b in this._targets)a[b]=this._targets[b];return a},e.prototype.clearTarget=function(a){delete this._targets[a]},e.prototype.setJump=function(){this._targets[e.JUMP_INPUT_ID]=new c.PlayerEntityTarget(!0,null,null)},e.prototype.clearJump=function(){delete this._targets[e.JUMP_INPUT_ID]},e.prototype.notifyCollision=function(a,d){if(a.getGroupId()==b.GroupId.Enemy)if(a instanceof c.LevelExitEntity){var e=a;this._nextLevelParams=e._nextLevelParamsFactory(this)}else this.setDying(a);else d==b.PolarEdge.Bottom?this._onGround=!0:d==b.PolarEdge.Right?this._onRightWall=!0:d==b.PolarEdge.Left&&(this._onLeftWall=!0)},e.prototype._createMotion=function(b){return this.isDying()?d.prototype._createMotion.call(this,b):new a.Level.Motion.CameraCenterPolarMotion(b,this)},e.prototype.updateAlive=function(a,b){var c=null,d=[];for(var e in this._targets){var f=this._targets[e];null!=f&&(f.jumping?f.jumped||(c=f):d.push(f))}if(this._gun){var g=this._bounds.getCenterRadiusPx(),h=this._gun.update(b,a,this._onGround,g,this._bounds.getCenterAngleRadians(),this.getVelocityRadiusPX(),this.getVelocityAngleRadians(g),d);h&&(this._velocityRPX+=h.r,this._velocityAPX+=h.a)}if(this._onGround){this._onRightWall?this._runningLeft=!0:this._onLeftWall&&(this._runningLeft=!1);var i;i=this._runningLeft?-1:1;var j=1/(1e3*(Math.abs(this._velocityAPX*this._velocityAPX*this._velocityAPX*7e3)+1));this._velocityAPX+=i*j*b,c&&(this._jumpNSound.play(),this._velocityRPX=this._jumpPower,c.jumped=!0)}else if(c?this._onRightWall?(this._runningLeft=!0,this._velocityRPX=this._jumpPower,this._velocityAPX=-this._jumpPower,c.jumped=!0,this._jumpNSound.play()):this._onLeftWall&&(this._runningLeft=!1,this._velocityRPX=this._jumpPower,this._velocityAPX=this._jumpPower,c.jumped=!0,this._jumpNSound.play()):(j=this._onRightWall?.001:this._onLeftWall?-.001:0,this._velocityAPX+=j*b),this._velocityRPX>0)for(var e in this._targets){var f=this._targets[e];if(null!=f&&f.jumping&&f.jumped){this._velocityRPX+=45e-5*b;break}}this._onGround=!1,this._onRightWall=!1,this._onLeftWall=!1,this._nextLevelParams&&(this._winSound.play(),a.winLevel(this._nextLevelParams),this._nextLevelParams=null)},e.JUMP_INPUT_ID=-1,e}(c.AbstractLivingPolarEntity);c.PlayerEntity=d}(c=b.Entity||(b.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.jumping=a,this.r=b,this.a=c}return a}();a.PlayerEntityTarget=b}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e,f,g,h,i,j){c.call(this,a,b,!0,d),this._searchRadius=e,this._acceleration=f,this._bounce=g,this._maxVelocityAPx=h,this._smallJumpVelocity=i,this._bigJumpVelocity=j}return __extends(d,c),d.prototype.updateAlive=function(b,c){if(null!=this._bounceA&&(this._velocityAPX=this._bounceA),this._onGround){var d=b.getGroup(a.GroupId.Player),e=!1,f=this.getBounds(),g=f.getCenterRadiusPx(),h=f.getCenterAngleRadians(),i=Math.sin(h),j=Math.cos(h),k=j*g,l=i*g;null==this._targetX&&(this._targetX=k),null==this._targetY&&(this._targetY=l);var m,n;if(d&&d.length>0){var o=d[0],p=o.entity.getBounds(),q=p.getCenterRadiusPx(),r=p.getCenterAngleRadians(),s=Math.sin(r),t=Math.cos(r);m=t*q,n=s*q,e=!0}else m=this._targetX,n=this._targetY;var u=m-k,v=n-l,w=u*u+v*v;w>this._searchRadius*this._searchRadius&&e?(m=this._targetX,n=this._targetY,u=m-k,v=m-l,w=u*u+v*v):(this._targetX=m,this._targetY=n);var x=Math.sqrt(w),y=u/x,z=v/x,A=a.PolarPoint.rotate(y,z,-h),B=A.x,C=A.y*this._acceleration;this._velocityAPX+=C,this._velocityAPX=Math.max(-this._maxVelocityAPx,Math.min(this._maxVelocityAPx,this._velocityAPX)),0>B?this._velocityRPX+=this._smallJumpVelocity:this._velocityRPX+=this._smallJumpVelocity+(this._bigJumpVelocity-this._smallJumpVelocity)*B}this._prevVelocityAPX=this._velocityAPX,this._bounceA=null,this._onGround=!1},d.prototype.notifyCollision=function(c,d){c instanceof b.BulletEntity?this.setDying(c):d==a.PolarEdge.Left||d==a.PolarEdge.Right?this._bounceA=-this._prevVelocityAPX*this._bounce:d==a.PolarEdge.Bottom&&(this._onGround=!0)},d}(b.AbstractLivingPolarEntity);b.SeekerEntity=c}(b=a.Entity||(a.Entity={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(a,b){this.entity=a,this.renderer=b}return a}();a.EntityHolder=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d,e,f){this._element=a,this._context=b,this._gravity=c,this._rendererFactory=d,this._maxCollisionSteps=e,this._entitySpawner=f}return c.prototype.createStateFactory=function(c,d,e,f,g,h,i){var j=this;return function(k){for(var l=new b.LevelState(j._element,k.player,j._gravity,j._context,j._rendererFactory,j._maxCollisionSteps,k.levelName,k.difficulty),m=0,n=h,o=g;e>m;){for(var p=m+1,q=Math.max(Math.min(k.difficulty*Math.PI/24+Math.PI/8,Math.PI/p),(o+f)/n),r=0;p>r;){var s,t=new b.AbstractEntity(b.GroupId.Terrain);if(0==m)s=new b.PolarBounds(f,0,h,2*Math.PI);else{var u=(2*Math.PI-q*p)/p,v=2*Math.PI*r/p+q/2;s=new b.PolarBounds(n,v,f,u)}s.normalize(),t._bounds=s,l.addEntity(t);var w=j._entitySpawner(s.getStartAngleRadians(),s.getOuterRadiusPx(),o,s.getWidthRadians(),Math.min(k.difficulty,k.difficulty*m*2/e));for(var x in w){var y=w[x];l.addEntity(y)}r++}n+=o+f+m*(i+2*k.difficulty),m++}var z=64,A=z/n,B=new a.Level.Entity.LevelExitEntity(function(b){return new a.Level.LevelStateFactoryParam(b,c,k.difficulty+d)});return B._bounds=new b.PolarBounds(n,Math.random()*Math.PI*2,z,A),B._bounds.normalize(),l.addEntity(B),k.player.reset(h+f+2,0),l.addEntity(k.player),l}},c}();c.ConcentricLevelStateFactory=d}(c=b.Factory||(b.Factory={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d,e,f){this._stateFactories=a,this._firstLevelName=b,this._jumpSound=c,this._shootSound=d,this._deathSound=e,this._winSound=f}return c.prototype.createStateFactory=function(){var c=this;return function(d){if(d instanceof b.LevelStateFactoryParam)return c._stateFactories[d.levelName](d);var e=new a.Level.Entity.Gun.AbstractGun(300,600,6,.1,1,c._shootSound),f=new a.Level.Entity.PlayerEntity(a.Level.GroupId.Player,1,.4,e,c._deathSound,c._jumpSound,c._winSound);f.setBounds(600,0,32,24);var g=new b.LevelStateFactoryParam(f,c._firstLevelName,1);return c._stateFactories[g.levelName](g)}},c}();c.DelegatingLevelStateFactory=d}(c=b.Factory||(b.Factory={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a,b,c,d,e,f,g,h){this._defaultEntityRenderer=a,this._spikeEntityRenderer=b,this._flappyEntityRenderer=c,this._bouncyEntityRenderer=d,this._seekerEntityRenderer=e,this._exitEntityRenderer=f,this._playerEntityRenderer=g,this._bulletEntityRenderer=h}return b.prototype.createEntityRendererFactory=function(){var b=this;return function(c){return c instanceof a.Level.Entity.SeekerEntity?b._seekerEntityRenderer:c instanceof a.Level.Entity.BouncyEntity?b._bouncyEntityRenderer:c instanceof a.Level.Entity.FlappyEntity?b._flappyEntityRenderer:c instanceof a.Level.Entity.ObstacleEntity?b._spikeEntityRenderer:c instanceof a.Level.Entity.LevelExitEntity?b._exitEntityRenderer:c instanceof a.Level.Entity.PlayerEntity?b._playerEntityRenderer:c instanceof a.Level.Entity.BulletEntity?b._bulletEntityRenderer:b._defaultEntityRenderer}},b}();b.HardCodedEntityRendererFactory=c}(c=b.Factory||(b.Factory={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(){}return c.prototype.createSpawner=function(c){return function(d,e,f,g,h){for(var i=[],j=h*Math.random()*2;j>1;){var k,l=Math.random()*j%5,m=Math.floor(l);switch(m){case 0:k=null;break;case 1:var n=new a.Level.Entity.ObstacleEntity(b.GroupId.Enemy,a.Level.Entity.ObstacleType.Spike),o=22+h,p=d+Math.random()*(g-o/e);n.setBounds(e,p,o,o),k=n;break;case 2:var q=new a.Level.Entity.FlappyEntity(b.GroupId.Enemy,1,c,Math.random()>.5,.06+.01*h,.3,e+f*Math.random()/2);q.setBounds(e+f/2,d+Math.random()*g,24+h,24+h),k=q;break;case 3:var r=new a.Level.Entity.BouncyEntity(b.GroupId.Enemy,1,c,.05+.02*h,Math.random()>.5,Math.random()>.5);r.setBounds(e,d+Math.random()*g,30,30),k=r;break;case 4:var s=new a.Level.Entity.SeekerEntity(b.GroupId.Enemy,1,c,200+30*h,.1,1.1,.1,.3,.65),o=Math.max(16,40-h*Math.random());s.setBounds(e,d+Math.random()*g,o,o),k=s}null!=k&&i.push(k),j-=l}return i}},c}();c.HardCodedEntitySpawner=d}(c=b.Factory||(b.Factory={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d,e,f){this._element=a,this._context=b,this._gravity=c,this._rendererFactory=d,this._maxCollisionSteps=e,this._entitySpawner=f}return c.prototype.createStateFactory=function(c,d,e,f,g,h,i){var j=this;return function(k){var l=new b.LevelState(j._element,k.player,j._gravity,j._context,j._rendererFactory,j._maxCollisionSteps,k.levelName,k.difficulty),m=new b.AbstractEntity(b.GroupId.Terrain);m._bounds=new b.PolarBounds(f,0,i-f,2*Math.PI),l.addEntity(m);for(var n=e;n>0;){for(var o=0,p=Math.PI/e,q=2*Math.PI*n/e+p/2,r=i,s={};h>o;){o++;var t=q,u=p;if(o==n||20*Math.random()<k.difficulty){var v=new b.AbstractEntity(b.GroupId.Terrain),w=f/r;v._bounds=new b.PolarBounds(r,q,g,w),v._bounds.normalize(),l.addEntity(v),t+=w,u-=w}if(h-o==n||20*Math.random()<k.difficulty){var v=new b.AbstractEntity(b.GroupId.Terrain),w=f/r;v._bounds=new b.PolarBounds(r,q+p-w,g,w),v._bounds.normalize(),l.addEntity(v),u-=w}r+=g;var x=j._entitySpawner(t,r+f,g,u,Math.min(k.difficulty,o*k.difficulty*2/h)),y=s[o];if(null==y&&(y=0),100*Math.random()<k.difficulty*(e-y)&&o>1){var z=new b.AbstractEntity(b.GroupId.Terrain);z._bounds=new b.PolarBounds(r,q+p,f,p),z._bounds.normalize(),l.addEntity(z),y++,s[o]=y}if(100*Math.random()>3){for(var A in x){var B=x[A];l.addEntity(B)}var C=new b.AbstractEntity(b.GroupId.Terrain);C._bounds=new b.PolarBounds(r,q,f,p),C._bounds.normalize(),l.addEntity(C)}r+=f}n--}var D=(g+f)*h+i,E=64,F=E/D,G=new a.Level.Entity.LevelExitEntity(function(b){return new a.Level.LevelStateFactoryParam(b,c,k.difficulty+d)});return G._bounds=new b.PolarBounds(D,Math.random()*Math.PI*2,E,F),G._bounds.normalize(),l.addEntity(G),k.player.reset(i+2,0),l.addEntity(k.player),l}},c}();c.SkyscraperLevelStateFactory=d}(c=b.Factory||(b.Factory={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){!function(a){a[a.Down=0]="Down",a[a.Left=1]="Left",a[a.Right=2]="Right"}(a.Gesture||(a.Gesture={}));a.Gesture}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){!function(a){a[a.Player=0]="Player",a[a.Enemy=1]="Enemy",a[a.Terrain=2]="Terrain"}(a.GroupId||(a.GroupId={}));a.GroupId}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(b){var c=function(a){function c(b,c,d,e,f,g,h,i){var j=this;a.call(this,b),this._player=c,this._gravity=d,this._context=e,this._rendererFactory=f,this._maxCollisionSteps=g,this._levelName=h,this._levelDifficulty=i,this._cameraCenterAngle=0,this._cameraCenterRadius=0,this._levelAgeMillis=0,this._groups=new Array,this._touchStartListener=function(a){for(var b in a.changedTouches){var c=a.changedTouches.item(b);j.setTarget(c.identifier,c.clientX,c.clientY,!0)}},this._touchEndListener=function(a){for(var b in a.changedTouches){var c=a.changedTouches.item(b);j.clearTarget(c.identifier)}},this._touchMoveListener=function(a){for(var b in a.changedTouches){var c=a.changedTouches.item(b);j.setTarget(c.identifier,c.clientX,c.clientY,!0)}};var k=!1;this._mouseDownListener=function(a){j.setTarget(0,a.clientX,a.clientY,!1),k=!0},this._mouseMoveListener=function(a){k&&j.setTarget(0,a.clientX,a.clientY,!1)},this._mouseUpListener=function(a){j.clearTarget(0),k=!1};var l=!0;this._keyDownListener=function(a){32!=a.keyCode&&88!=a.keyCode||!l||(j._player.setJump(),l=!1)},this._keyUpListener=function(a){(32==a.keyCode||88==a.keyCode)&&(j._player.clearJump(),l=!0)}}return __extends(c,a),c.prototype.init=function(){a.prototype.init.call(this);var b=window.localStorage.getItem(this._levelName+"-"+this._levelDifficulty);b&&(this._bestLevelTime=parseInt(b))},c.prototype.getGroup=function(a){return this._groups[a]},c.prototype.setCameraCenter=function(a,b){this._cameraCenterRadius=a,this._cameraCenterAngle=b},c.prototype.setTarget=function(a,c,d,e){if(this._player.isDead())this.fireStateChangeEvent(new b.LevelStateRestartParam);else{var f,g=this._element.clientWidth,h=this._element.clientHeight,i=(this._player.getBounds(),this._cameraCenterRadius),j=this._cameraCenterAngle,k=Math.sin(j),l=Math.cos(j),m=i*l,n=i*k,o=c-g/2,p=d-h/2;o>0&&o*h>Math.abs(p)*g?f=b.Gesture.Right:0>o&&-o*h>Math.abs(p)*g?f=b.Gesture.Left:p>0&&(f=b.Gesture.Down);var q=b.PolarPoint.rotate(o,p,j+Math.PI/2),r=m+q.x,s=n+q.y,t=Math.atan2(s,r),u=Math.sqrt(r*r+s*s);this._player.setTarget(a,u,t,e,f)}},c.prototype.clearTarget=function(a){this._player.clearTarget(a)},c.prototype.start=function(){a.prototype.start.call(this),"ontouchstart"in window||window.DocumentTouch?(this._element.addEventListener("touchstart",this._touchStartListener),this._element.addEventListener("touchmove",this._touchMoveListener),this._element.addEventListener("touchend",this._touchEndListener),this._element.addEventListener("touchleave",this._touchEndListener),this._element.addEventListener("touchcancel",this._touchEndListener)):(this._element.addEventListener("mousedown",this._mouseDownListener),this._element.addEventListener("mouseup",this._mouseUpListener),this._element.addEventListener("mousemove",this._mouseMoveListener)),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener)},c.prototype.stop=function(){a.prototype.stop.call(this),this._element.removeEventListener("touchstart",this._touchStartListener),this._element.removeEventListener("touchmove",this._touchMoveListener),this._element.removeEventListener("touchend",this._touchEndListener),this._element.removeEventListener("touchleave",this._touchEndListener),this._element.removeEventListener("touchcancel",this._touchEndListener),this._element.removeEventListener("mousedown",this._mouseDownListener),this._element.removeEventListener("mouseup",this._mouseUpListener),this._element.removeEventListener("mousemove",this._mouseMoveListener),window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener)},c.prototype.getGravity=function(){return this._gravity},c.prototype.addEntity=function(a){for(var c=a.getGroupId();this._groups.length<=c;)this._groups.push(new Array);var d=this._groups[c],e=this._rendererFactory(a);d.push(new b.EntityHolder(a,e))},c.prototype.update=function(a){if(this.updateMotion(a),this._player.isDead()||this._player.isDying()||(this._levelAgeMillis+=a),this.isStarted()){var b=this.calculateCollisions(a);this.resolveCollisions(a,b),this.applyMotion()}},c.prototype.resolveCollisions=function(a,c){for(var d=0;d<c.length;){var e,f,g=c[d],h=g.entityHolder1.entity,i=g.entityHolder2.entity,j=h.getMass(),k=i.getMass();if(g.sensorCollision||null==j&&null==k)e=b.PolarEdge.Undefined,f=b.PolarEdge.Undefined;else{var l=g.nearestCollisionIntersection.getCenterRadiusPx(),m=h.getVelocityRadiusPX(),n=i.getVelocityRadiusPX(),o=h.getVelocityAngleRadians(l),p=i.getVelocityAngleRadians(l),q=n-m,r=p-o;if(e=this.calculateCollisionEdge(q,r,g.collisionMotion1.getBounds(),g.nearestCollisionIntersection),f=this.calculateCollisionEdge(-q,-r,g.collisionMotion2.getBounds(),g.nearestCollisionIntersection),e==-f&&e!=b.PolarEdge.Undefined){if(e==b.PolarEdge.Top||e==b.PolarEdge.Bottom)if(null==j)i.setVelocityRadiusPX(m);else if(null==k)h.setVelocityRadiusPX(n);else{var s=(n*k+m*j)/(j+k);i.setVelocityRadiusPX(s),h.setVelocityRadiusPX(s)}else if(null==j)i.setVelocityAngleRadians(o,l);else if(null==k)h.setVelocityAngleRadians(p,l);else{var t=(p*k+o*j)/(j+k);i.setVelocityAngleRadians(t,l),h.setVelocityAngleRadians(t,l)}for(var u=d+1;u<c.length;){var v=c[u];v.entityHolder1==g.entityHolder1||v.entityHolder1==g.entityHolder2||v.entityHolder2==g.entityHolder1||v.entityHolder2==g.entityHolder2?c.splice(u,1):u++}g.bestMotion1.apply(this),g.entityHolder1.motionOffset=g.collisionTime,g.bestMotion2.apply(this),g.entityHolder2.motionOffset=g.collisionTime,e==b.PolarEdge.Left?h.setAnchorRight(!1):e==b.PolarEdge.Right&&h.setAnchorRight(!0),f==b.PolarEdge.Left?i.setAnchorRight(!1):f==b.PolarEdge.Right&&i.setAnchorRight(!0);var w=a-g.collisionTime;g.entityHolder1.motion=h.calculateMotion(w),g.entityHolder2.motion=i.calculateMotion(w),this.calculateCollisionsForEntity(a,c,g.entityHolder1,this._groups.length),this.calculateCollisionsForEntity(a,c,g.entityHolder2,this._groups.length)}else console.log("unmatched or undefined edges falling through!"),e=b.PolarEdge.Undefined,f=b.PolarEdge.Undefined}h.notifyCollision(i,e),i.notifyCollision(h,f),d++}},c.prototype.calculateCollisionEdge=function(a,c,d,e){var f,g=e.containsVertically(d.getInnerRadiusPx()),h=e.containsHorizontally(d.getStartAngleRadians()),i=e.getHeightPx();f=g?e.getOuterCircumferencePx():e.getInnerCircumferencePx();var j;return j=i>f||g&&0>=a||!g&&a>=0?h?c>0?b.PolarEdge.Left:b.PolarEdge.Undefined:0>c?b.PolarEdge.Right:b.PolarEdge.Undefined:g?b.PolarEdge.Bottom:b.PolarEdge.Top},c.prototype.calculateCollisionsForEntity=function(a,b,c,d){var e=(c.motion,c.entity);if(e.isCollidable())for(var f=d;f>0;)if(f--,f!=e.getGroupId())for(var g=this._groups[f],h=g.length;h>0;){h--;var i=g[h];if(i.entity.isCollidable()){var j=(i.motion,this.calculateCollision(a,c,i));if(null!=j){for(var k=0;k<b.length;){var l=b[k];if(l.collisionTime>j.collisionTime)break;k++}b.splice(k,0,j)}}}},c.prototype.calculateCollisions=function(a){for(var b=new Array,c=this._groups.length;c>0;){c--;for(var d=this._groups[c],e=d.length;e>0;){e--;var f=d[e];this.calculateCollisionsForEntity(a,b,f,c)}}return b},c.prototype.calculateContinuousSamples=function(a,b){var c=1;if(b.entity.isContinuousCollisions())for(var d=!1;!d;){var e=a/c,f=b.entity.calculateMotion(e);
f.getBounds().overlaps(b.entity.getBounds())?d=!0:c++}return c},c.prototype.calculateCollision=function(a,c,d){var e,f=c.motion,g=d.motion;if(null!=f&&null!=g){var h,i,j,k,l=c.entity,m=d.entity,n=this.calculateContinuousSamples(a,c),o=this.calculateContinuousSamples(a,d),p=Math.max(n,o);if(p>1){var q=1;for(k=null;p>=q;){var r=a*q/p,s=l.calculateMotion(r),t=m.calculateMotion(r);if(k=b.PolarBounds.intersect(s.getBounds(),t.getBounds()),null!=k){i=s,j=t,h=r;break}q++}}else i=f,j=g,h=a,k=b.PolarBounds.intersect(i.getBounds(),j.getBounds());if(null!=k)if(c.entity.isSensor()||d.entity.isSensor()||c.entity.getBounds().overlaps(d.entity.getBounds()))e=new b.Collision(!0,a,k,c,i,j,d,g,g);else{for(var u=0,v=Math.max(c.motionOffset,d.motionOffset),w=h,x=k,y=null,z=null,A=i,B=j;u<this._maxCollisionSteps;){var C=(v+w)/2,D=c.entity.calculateMotion(C),E=d.entity.calculateMotion(C),F=b.PolarBounds.intersect(D.getBounds(),E.getBounds());null!=F?(w=C,x=F,A=D,B=E):(v=C,y=D,z=E),u++}null==y&&null==z&&(v=0,y=c.entity.calculateMotion(0),z=d.entity.calculateMotion(0)),e=new b.Collision(!1,v,x,c,y,A,d,z,B)}else e=null}else e=null;return e},c.prototype.updateMotion=function(a){for(var b in this._groups)for(var c=this._groups[b],d=c.length;d>0;){d--;var e=c[d],f=e.entity;if(f.update(this,a),f.isDead())c.splice(d,1);else{var g=f.calculateMotion(a);e.motion=g,e.motionOffset=0}}},c.prototype.applyMotion=function(){for(var a in this._groups){var b=this._groups[a];for(var c in b){var d=b[c],e=d.motion;null!=e&&e.apply(this)}}},c.prototype.toTimeString=function(a){var b=Math.floor(a/1e3),c=Math.floor(b/60);b%=60;for(var d=""+b;d.length<2;)d="0"+d;return c+":"+d},c.prototype.render=function(){var a=this._element.clientWidth,b=this._element.clientHeight,c=Math.floor(Math.min(b/20,a/20));this._context.font="bold "+c+"px Courier",this._context.fillStyle="#000000",this._context.fillRect(0,0,a,b),this._context.fillStyle="#FFFFFF";var d=this.toTimeString(this._levelAgeMillis);this._context.fillText(d,c,1.5*c);var e;e=this._bestLevelTime?"BEST "+this.toTimeString(this._bestLevelTime):"Unbeaten!";var f=this._context.measureText(e);if(this._context.fillText(e,a-f.width-c,c+c/2),this._player.isDead()||this._player.isDying()){var g="GAME OVER",h=this._context.measureText(g);this._context.fillText(g,(a-h.width)/2,(b+c)/2)}this._context.save();var i=(this._player.getBounds(),this._cameraCenterRadius),j=this._cameraCenterAngle,k=Math.sin(j),l=Math.cos(j),m=-i*l,n=-i*k,o=Math.min(1,a/600,b/500);this._context.translate(a/2,b/2),this._context.rotate(-j-Math.PI/2),this._context.scale(o,o),this._context.translate(m,n);for(var p in this._groups)for(var q=this._groups[p],r=q.length;r>0;){r--;var s=q[r],t=s.entity;if(!t.isDead()){var u=s.renderer;u.render(this._context,t)}}this._context.restore()},c.prototype.winLevel=function(a){(null==this._bestLevelTime||this._bestLevelTime>this._levelAgeMillis)&&window.localStorage.setItem(this._levelName+"-"+this._levelDifficulty,""+this._levelAgeMillis),this.fireStateChangeEvent(a)},c}(a.AbstractUpdatingState);b.LevelState=c}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.player=a,this.levelName=b,this.difficulty=c}return a}();a.LevelStateFactoryParam=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(){}return a}();a.LevelStateRestartParam=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.apply=function(b){a.prototype.apply.call(this,b);var c=this.getBounds();b.setCameraCenter(c.getCenterRadiusPx(),c.getCenterAngleRadians())},b}(a.PolarMotion);a.CameraCenterPolarMotion=b}(b=a.Motion||(a.Motion={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d){this._cx=a,this._cy=b,this._bounds=c,this._entity=d}return a.prototype.getBounds=function(){return this._bounds},a.prototype.getEntity=function(){return this._entity},a.prototype.apply=function(a){this._entity.setCenter(this._cx,this._cy)},a}();a.CartesianMotion=b}(b=a.Motion||(a.Motion={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d){this._r=a,this._a=b,this._height=c,this._arc=d}return a.intersect=function(b,c){var d=b.permutate(),e=c.permutate();for(var f in d){var g=d[f];for(var h in e){var i=e[h],j=a.reallyIntersects(g,i);if(null!=j)return j.normalize(),j}}return null},a.reallyIntersects=function(b,c){var d=b.getInnerRadiusPx(),e=b.getOuterRadiusPx(),f=b.getStartAngleRadians(),g=b.getEndAngleRadians(),h=c.getInnerRadiusPx(),i=c.getOuterRadiusPx(),j=c.getStartAngleRadians(),k=c.getEndAngleRadians(),l=Math.max(d,h),m=Math.min(e,i)-l;if(m>0){var n=Math.max(f,j),o=Math.min(g,k)-n;return o>0?new a(l,n,m,o):null}return null},a.prototype.containsVertically=function(a){return this._r<=a&&this._r+this._height>a},a.prototype.containsHorizontally=function(a){var b=this.normalizeAngle(a);return this._a<=b&&this._a+this._arc>b},a.prototype.getInnerRadiusPx=function(){return this._r},a.prototype.getHeightPx=function(){return this._height},a.prototype.getOuterRadiusPx=function(){return this._r+this._height},a.prototype.getStartAngleRadians=function(){return this._a},a.prototype.getCenterRadiusPx=function(){return this._r+this._height/2},a.prototype.getEndAngleRadians=function(){return this._a+this._arc},a.prototype.getCenterAngleRadians=function(){return this._a+this._arc/2},a.prototype.getWidthRadians=function(){return this._arc},a.prototype.getOuterCircumferencePx=function(){var a=this.getOuterRadiusPx();return a*this._arc},a.prototype.getInnerCircumferencePx=function(){var a=this.getInnerRadiusPx();return a*this._arc},a.prototype.normalize=function(){this._a=this.normalizeAngle(this._a)},a.prototype.normalizeAngle=function(a){for(;0>a;)a+=2*Math.PI;return a%(2*Math.PI)},a.prototype.permutate=function(){var b=this.getEndAngleRadians(),c=[this];return b>2*Math.PI&&c.push(new a(this._r,this._a-2*Math.PI,this._height,this._arc)),c},a.prototype.overlaps=function(b){return null!=a.intersect(this,b)},a}();a.PolarBounds=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){!function(a){a[a.Top=-1]="Top",a[a.Left=-2]="Left",a[a.Bottom=1]="Bottom",a[a.Right=2]="Right",a[a.Undefined=0]="Undefined"}(a.PolarEdge||(a.PolarEdge={}));a.PolarEdge}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b=function(){function a(a,b){this.r=a,this.a=b}return a.getCartesianPoint=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=d*a,f=c*a;return{x:e,y:f}},a.getPolarPoint=function(b,c){var d=Math.atan2(c,b),e=Math.sqrt(b*b+c*c);return new a(e,d)},a.rotate=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=a*e-b*d,g=a*d+b*e;return{x:f,y:g}},a}();a.PolarPoint=b}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;var c=b.getBounds(),d=b.getStateAgeMillis()%3e3;d-=1500,d=Math.abs(d);var e=1+d/3e3,f=2-d/1500,g=c.getCenterAngleRadians(),h=c.getStartAngleRadians();h=g+(h-g)*e;var i=Math.sin(h),j=Math.cos(h),k=c.getEndAngleRadians();k=g+(k-g)*e;var l=Math.sin(k),m=Math.cos(k),n=Math.sin(g),o=Math.cos(g),p=c.getCenterRadiusPx(),q=c.getInnerRadiusPx();q=p+(q-p)*f;var r=c.getOuterRadiusPx();r=p+(r-p)*f,q>0&&(a.beginPath(),a.moveTo(j*p,i*p),a.lineTo(o*q,n*q),a.lineTo(m*p,l*p),a.lineTo(o*r,n*r),a.closePath(),a.fill(),a.stroke())},a}();a.BouncyEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;for(var c=b.getBounds(),d=500,e=b.getStateAgeMillis(),f=3,g=e%d/(f*d),h=1/f,i=0;f>i;){var j=g+h*i;i++,a.globalAlpha=Math.max(0,1-j*j);var k=c.getWidthRadians(),l=c.getCenterAngleRadians(),m=l-k*j,n=l+k*j,o=Math.sin(m),p=Math.cos(m),q=Math.sin(n),r=Math.cos(n),s=c.getCenterRadiusPx(),t=c.getHeightPx(),u=s-t*j,v=s+t*j;u>0&&(a.beginPath(),a.moveTo(p*v,o*v),a.arc(0,0,v,m,n,!1),a.lineTo(r*u,q*u),a.arc(0,0,u,n,m,!0),a.closePath(),a.stroke())}a.globalAlpha=1},a}();a.ExitEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;var c,d=b.getBounds(),e=d.getCenterAngleRadians(),f=(Math.sin(e),Math.cos(e),b.getStateAgeMillis());c=200>f?f/200:1;var g=d.getStartAngleRadians();g=e+(g-e)*c;var h=Math.sin(g),i=Math.cos(g),j=d.getEndAngleRadians();j=e+(j-e)*c;var k=Math.sin(j),l=Math.cos(j),m=d.getInnerRadiusPx(),n=d.getOuterRadiusPx();m>0&&(a.beginPath(),a.moveTo(i*n,h*n),a.lineTo(i*m,h*m),a.lineTo(l*m,k*m),a.lineTo(l*n,k*n),a.closePath(),a.fill(),a.stroke())},a}();a.FlappyEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;var c=b.getBounds(),d=c.getStartAngleRadians(),e=Math.sin(d),f=Math.cos(d),g=c.getEndAngleRadians(),h=Math.sin(g),i=Math.cos(g),j=c.getInnerRadiusPx(),k=c.getOuterRadiusPx();j>0&&(a.beginPath(),a.moveTo(f*k,e*k),a.arc(0,0,k,d,g,!1),a.lineTo(i*j,h*j),a.arc(0,0,j,g,d,!0),a.closePath(),a.fill(),a.stroke())},a}();a.PathEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;var c=b.getBounds(),d=(b.getStateAgeMillis()%3e3,c.getCenterAngleRadians()),e=c.getStartAngleRadians(),f=(Math.sin(e),Math.cos(e)),g=c.getEndAngleRadians(),h=(Math.sin(g),Math.cos(g),Math.sin(d)),i=Math.cos(d),j=c.getCenterRadiusPx(),k=c.getInnerRadiusPx(),l=c.getOuterRadiusPx();if(k>0){var m=Math.max(Math.abs(f*j-i*j),Math.abs(l-j));a.beginPath(),a.arc(i*j,h*j,m,0,2*Math.PI),a.closePath(),a.fill(),a.stroke()}},a}();a.SeekerEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={}));var Poust;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this._lineWidth=a,this._strokeStyle=b,this._fillStyle=c}return a.prototype.render=function(a,b){a.strokeStyle=this._strokeStyle,a.fillStyle=this._fillStyle,a.lineWidth=this._lineWidth;var c=b.getBounds(),d=c.getStartAngleRadians(),e=Math.sin(d),f=Math.cos(d),g=c.getEndAngleRadians(),h=Math.sin(g),i=Math.cos(g),j=c.getCenterAngleRadians(),k=Math.sin(j),l=Math.cos(j),m=c.getInnerRadiusPx(),n=c.getOuterRadiusPx();m>0&&(a.beginPath(),a.moveTo(f*m,e*m),a.lineTo(l*(n+c.getHeightPx()/2),k*n),a.lineTo(i*m,h*m),a.arc(0,0,m,g,d,!0),a.closePath(),a.fill(),a.stroke())},a}();a.SpikeEntityRenderer=b}(b=a.Renderer||(a.Renderer={}))}(b=a.Level||(a.Level={}))}(Poust||(Poust={})),window.onload=function(){var a=document.getElementById("canvas"),b=new Poust.AudioSound(["res/jump1.wav","res/jump2.wav","res/jump3.wav","res/jump4.wav"]),c=new Poust.AudioSound(["res/shoot1.wav","res/shoot2.wav","res/shoot3.wav"]),d=new Poust.AudioSound(["res/death1.wav"]),e=new Poust.AudioSound(["res/hurt1.wav"]),f=new Poust.AudioSound(["res/win1.wav"]),g=a;g.setAttribute("width",""+document.body.clientWidth+"px"),g.setAttribute("height",""+document.body.clientHeight+"px");var h=g.getContext("2d"),i=h.createRadialGradient(0,0,0,0,0,1500);i.addColorStop(0,"rgba(0, 0, 0, 0.5)"),i.addColorStop(.2,"rgba(255, 0, 255, 0.5)"),i.addColorStop(.32,"rgba(255, 0, 0, 0.5)"),i.addColorStop(.44,"rgba(255, 255, 0, 0.5)"),i.addColorStop(.56,"rgba(0, 255, 0, 0.5)"),i.addColorStop(.68,"rgba(0, 255, 255, 0.5)"),i.addColorStop(.8,"rgba(0, 0, 255, 0.6)"),i.addColorStop(.92,"rgba(255, 255, 255, 0.7)"),i.addColorStop(1,"rgba(255, 255, 255, 0)");var j=new Poust.Level.Renderer.PathEntityRenderer(2,"#FFFFFF",i),k=new Poust.Level.Renderer.FlappyEntityRenderer(2,"#FFFFFF",i),l=new Poust.Level.Renderer.SpikeEntityRenderer(2,"#FFFFFF",i),m=new Poust.Level.Renderer.BouncyEntityRenderer(2,"#FFFFFF",i),n=new Poust.Level.Renderer.SeekerEntityRenderer(2,"#FFFFFF",i),o=new Poust.Level.Renderer.ExitEntityRenderer(2,"#FFFFFF",i),p=new Poust.Level.Renderer.PathEntityRenderer(2,"#FFFFFF","rgba(255, 0, 0, 0.7)"),q=new Poust.Level.Renderer.SeekerEntityRenderer(2,"#FFFFAA","rgba(255, 255, 0, 0.7"),r=new Poust.Level.Factory.HardCodedEntityRendererFactory(j,l,k,m,n,o,p,q).createEntityRendererFactory(),s="1",t="2",u=.0014,v=10,w=(new Poust.Level.Factory.HardCodedEntitySpawner).createSpawner(e),x=new Poust.Level.Factory.ConcentricLevelStateFactory(a,h,u,r,v,w),y=new Poust.Level.Factory.SkyscraperLevelStateFactory(a,h,u,r,v,w),z={};z[s]=x.createStateFactory(t,1,10,20,70,300,5),z[t]=y.createStateFactory(s,1,8,20,100,10,300);var A=new Poust.Level.Factory.DelegatingLevelStateFactory(z,s,b,c,d,f).createStateFactory(),B=new Poust.Engine(A);B.setStateFromParam(new Poust.Level.LevelStateRestartParam)};